<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NNK4X8M');</script><script src="https://use.fontawesome.com/c72bfae6f9.js"></script><link rel="preload" href="/component---src-layouts-index-js-f7e5fddfeabb77ba9307.js" as="script"/><link rel="preload" href="/component---src-templates-page-js-77e225def5937e05c33b.js" as="script"/><link rel="preload" href="/path---postgraphile-procedures-e873f35d9e807a23067e.js" as="script"/><link rel="preload" href="/app-7cfd545637f6cabb4980.js" as="script"/><link rel="preload" href="/commons-097a3c7bcbdcfe23a531.js" as="script"/><title data-react-helmet="true">Graphile | Procedures</title><meta data-react-helmet="true" name="description" content="Utilities to build powerful and performant GraphQL APIs"/><meta data-react-helmet="true" name="keywords" content="GraphQL, API, Graph, PostgreSQL, PostGraphile, PostGraphQL, Postgres-GraphQL, server, plugins, introspection, reflection"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=5.0"/><link rel="stylesheet" href="/styles.css?t=2018-05-05T20-11-28.663Z"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NNK4X8M" height="0" width="0" style="display:none;visibility:hidden;"></iframe></noscript><div id="___gatsby"><div tabindex="-1" data-reactroot="" data-reactid="1" data-react-checksum="784949111"><div class="template-page" data-reactid="2"><!-- react-empty: 3 --><div class="header-notice pv3 ph3 f5 lh-title bg-near-black moon-gray" data-reactid="4"><div class="container" data-reactid="5"><div class="row" data-reactid="6"><div class="col-xs-12" data-reactid="7"><strong data-reactid="8">NOTICE</strong><!-- react-text: 9 -->: PostGraphQL has been<!-- /react-text --><!-- react-text: 10 --> <!-- /react-text --><a href="/history" data-reactid="11">renamed to PostGraphile</a><!-- react-text: 12 -->. If you were using <!-- /react-text --><code data-reactid="13">postgraphql@next</code><!-- react-text: 14 --> you should update to<!-- /react-text --><!-- react-text: 15 --> <!-- /react-text --><code data-reactid="16">postgraphile</code><!-- react-text: 17 --> instead as<!-- /react-text --><!-- react-text: 18 --> <!-- /react-text --><code data-reactid="19">postgraphql@next</code><!-- react-text: 20 --> will not receive any further updates.<!-- /react-text --></div></div></div></div><header class="header content absolute z-999 w-100" data-reactid="21"><nav class="navbar" data-reactid="22"><div class="container" data-reactid="23"><input type="checkbox" class="navbar-toggler input-reset" id="toggle" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" data-reactid="24"/><div class="nav-controls nested-list-reset " data-reactid="25"><div class="navbar-crosses" data-reactid="26"><span class="line line-1" data-reactid="27"> </span><span class="line line-2" data-reactid="28"> </span><span class="line line-3" data-reactid="29"> </span></div><ul class="navbar-nav flex w-100" data-reactid="30"><li class="navbar-item" data-reactid="31"><a class="nav-link " href="/" data-reactid="32"><span class="home-icon fa fa-home" data-reactid="33"></span><!-- react-text: 34 --> <!-- /react-text --><span class="home" data-reactid="35">Home</span></a></li><li class="navbar-item" data-reactid="36"><a class="nav-link active" href="/postgraphile/" data-reactid="37">PostGraphile</a></li><li class="navbar-item" data-reactid="38"><a class="nav-link " href="/graphile-build/" data-reactid="39">Graphile Build</a></li><li class="navbar-item" data-reactid="40"><a class="nav-link " href="/support/" data-reactid="41">Support</a></li><li class="navbar-item" data-reactid="42"><a class="nav-link" href="https://graphql-training.com" title="GraphQL Training in London, Europe and Remote" data-reactid="43">GraphQL Training</a></li><li class="navbar-item ml-auto navbar-item-right" data-reactid="44"><span class="searchbox-container" data-reactid="45"><input id="search-box" placeholder="Search" data-reactid="46"/><span class="fa fa-search searchbox-search" data-reactid="47"></span></span></li><li class="navbar-item navbar-item-right" data-reactid="48"><a class="nav-link nav-github-link flex items-center" href="https://github.com/graphile" data-reactid="49"><span class="f3 fa fa-github" data-reactid="50"></span><!-- react-text: 51 --> <!-- /react-text --><span class="github" data-reactid="52">Github</span></a></li></ul></div></div></nav></header><div class="page-content" data-reactid="53"><section data-reactid="54"><div class="container" data-reactid="55"><div class="row between-xs" data-reactid="56"><aside class="sidebar col-xs-12 col-md-3 last-xs mt3" data-reactid="57"><section data-reactid="58"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="59">Overview</h4><div class="nested-list-reset" data-reactid="60"><ul class="page-list nav flex-column mb5" data-reactid="61"><li class="f6 lh-copy pv1" data-reactid="62"><a class="nav-link " href="/postgraphile/introduction/" data-reactid="63">Introduction</a></li><li class="f6 lh-copy pv1" data-reactid="64"><a class="nav-link " href="/postgraphile/quick-start-guide/" data-reactid="65">Quick Start Guide</a></li><li class="f6 lh-copy pv1" data-reactid="66"><a class="nav-link " href="/postgraphile/requirements/" data-reactid="67">Requirements</a></li><li class="f6 lh-copy pv1" data-reactid="68"><a class="nav-link " href="/postgraphile/performance/" data-reactid="69">Performance</a></li><li class="f6 lh-copy pv1" data-reactid="70"><a class="nav-link " href="/postgraphile/connections/" data-reactid="71">Connections</a></li><li class="f6 lh-copy pv1" data-reactid="72"><a class="nav-link " href="/postgraphile/filtering/" data-reactid="73">Filtering</a></li><li class="f6 lh-copy pv1" data-reactid="74"><a class="nav-link " href="/postgraphile/relations/" data-reactid="75">Relations</a></li><li class="f6 lh-copy pv1" data-reactid="76"><a class="nav-link " href="/postgraphile/crud-mutations/" data-reactid="77">CRUD Mutations</a></li><li class="f6 lh-copy pv1" data-reactid="78"><a class="nav-link " href="/postgraphile/computed-columns/" data-reactid="79">Computed Columns</a></li><li class="f6 lh-copy pv1" data-reactid="80"><a class="nav-link " href="/postgraphile/custom-queries/" data-reactid="81">Custom Queries</a></li><li class="f6 lh-copy pv1" data-reactid="82"><a class="nav-link " href="/postgraphile/custom-mutations/" data-reactid="83">Custom Mutations</a></li><li class="f6 lh-copy pv1" data-reactid="84"><a class="nav-link " href="/postgraphile/smart-comments/" data-reactid="85">Smart Comments</a></li><li class="f6 lh-copy pv1" data-reactid="86"><a class="nav-link " href="/postgraphile/security/" data-reactid="87">Security</a></li><li class="f6 lh-copy pv1" data-reactid="88"><a class="nav-link " href="/postgraphile/introspection/" data-reactid="89">Introspection</a></li><li class="f6 lh-copy pv1" data-reactid="90"><a class="nav-link " href="/postgraphile/extending/" data-reactid="91">Extending PostGraphile</a></li></ul></div></section><section data-reactid="92"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="93">Guides</h4><div class="nested-list-reset" data-reactid="94"><ul class="page-list nav flex-column mb5" data-reactid="95"><li class="f6 lh-copy pv1" data-reactid="96"><a class="nav-link " href="/postgraphile/evaluating/" data-reactid="97">Evaluating for your Project</a></li><li class="f6 lh-copy pv1" data-reactid="98"><a class="nav-link " href="/postgraphile/jwt-guide/" data-reactid="99">PostGraphile JWT Guide</a></li><li class="f6 lh-copy pv1" data-reactid="100"><a class="nav-link " href="/postgraphile/default-role/" data-reactid="101">The Default Role</a></li><li class="f6 lh-copy pv1" data-reactid="102"><a class="nav-link active" href="/postgraphile/procedures/" data-reactid="103">PostgreSQL Procedures</a></li><li class="f6 lh-copy pv1" data-reactid="104"><a class="nav-link " href="/postgraphile/postgresql-schema-design/" data-reactid="105">PostgreSQL Schema Design</a></li><li class="f6 lh-copy pv1" data-reactid="106"><a class="nav-link " href="/postgraphile/postgresql-indexes/" data-reactid="107">PostgreSQL Indexes</a></li><li class="f6 lh-copy pv1" data-reactid="108"><a class="nav-link " href="/postgraphile/v4-new-features/" data-reactid="109">v4 Feature Guide</a></li><li class="f6 lh-copy pv1" data-reactid="110"><a class="nav-link " href="/postgraphile/v3-migration/" data-reactid="111">v3 → v4 Migration Guide</a></li></ul></div></section><section data-reactid="112"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="113">Usage</h4><div class="nested-list-reset" data-reactid="114"><ul class="page-list nav flex-column mb5" data-reactid="115"><li class="f6 lh-copy pv1" data-reactid="116"><a class="nav-link " href="/postgraphile/usage-cli/" data-reactid="117">CLI Usage</a></li><li class="f6 lh-copy pv1" data-reactid="118"><a class="nav-link " href="/postgraphile/usage-library/" data-reactid="119">Library Usage</a></li><li class="f6 lh-copy pv1" data-reactid="120"><a class="nav-link " href="/postgraphile/usage-schema/" data-reactid="121">Schema-only Usage</a></li></ul></div></section></aside><div class="col-xs-12 col-md-9 first-xs main-content" data-reactid="122"><div class="row" data-reactid="123"><div class="col-xs-12" style="width:100%;" data-reactid="124"><h1 id="procedures"><a href="#procedures" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Procedures</h1>
<p>Procedures in PostgreSQL are very important to understand in order to make the most powerful PostGraphile server you can. Procedures allow you to define business logic in the database in SQL or one of many other scripting languages. Often putting your business logic in the database will be more performant as PostgreSQL is already finely tuned to be highly performant and scale for data intensive uses.</p>
<p>There are a few ways procedures in PostGraphile can be used. All of these will be covered in their own section.</p>
<ol>
<li>As <a href="#mutation-procedures">mutations</a>.</li>
<li>As <a href="#query-procedures">queries</a>.</li>
<li>As <a href="#connection-procedures">connections</a> (list of nodes, like <code>postNodes</code>).</li>
<li>As <a href="#computed-columns">computed columns</a>.</li>
</ol>
<p>For an example of what procedures look like, see the <a href="https://github.com/graphile/postgraphile/blob/master/examples/forum/schema.sql">forum example SQL schema</a>.</p>
<h2 id="recommended-reading"><a href="#recommended-reading" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Recommended Reading</h2>
<ul>
<li>PostgreSQL <a href="http://www.postgresql.org/docs/current/static/sql-createfunction.html"><code>CREATE FUNCTION</code></a> documentation for actually creating procedures.</li>
<li>PostgreSQL <a href="http://www.postgresql.org/docs/current/static/sql-createtrigger.html"><code>CREATE TRIGGER</code></a> documentation.</li>
<li>StackOverflow answer describing <a href="http://stackoverflow.com/a/11166268/1568890">computed columns in PostgreSQL</a>.</li>
</ul>
<h2 id="scripting-languages"><a href="#scripting-languages" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scripting Languages</h2>
<p>Procedures in PostgreSQL require you to use a scripting language. The two most common procedure languages for PostgreSQL are SQL and <a href="http://www.postgresql.org/docs/current/static/plpgsql.html">PL/pgSQL</a>. SQL is probably the easiest to use as you are most likely already familiar with it. PL/pgSQL is PostgreSQL’s custom scripting language which is fairly easy to find plenty of StackOverflow and other resources on with a few search engine queries. You’ll need to learn PL/pgSQL if you want to write any triggers, because SQL can’t be used for triggers. But again, don’t worry, you can definitely make awesome applications without knowing PL/pgSQL as well as other languages you are familiar with as long as you defer to the internet.</p>
<p>A simple procedure written with SQL looks like this:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> <span class="token keyword">add</span><span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$
  <span class="token keyword">select</span> <span class="token number">a</span> <span class="token operator">+</span> <span class="token number">b</span><span class="token punctuation">;</span>
$$ <span class="token keyword">language sql</span> immutable strict<span class="token punctuation">;</span>
</code></pre>
      </div>
<p>The sample procedure with PL/pgSQL would look like this:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> <span class="token keyword">add</span><span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$
<span class="token keyword">begin</span>
  <span class="token keyword">return</span> <span class="token number">a</span> <span class="token operator">+</span> <span class="token number">b</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
$$ language plpgsql immutable strict<span class="token punctuation">;</span>
</code></pre>
      </div>
<p>If you don’t want to use PL/pgSQL or SQL, many popular scripting languages can be used <em>inside</em> PostgreSQL to write your procedures! You can see a few of these projects here:</p>
<ul>
<li><a href="https://github.com/plv8/plv8">JavaScript (plv8)</a></li>
<li><a href="https://github.com/knu/postgresql-plruby">Ruby (plruby)</a></li>
</ul>
<p>A procedure defined using JavaScript (for example) would look like:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token comment">-- This does look the exact same as the PL/pgSQL example…</span>
<span class="token keyword">create</span> <span class="token keyword">function</span> <span class="token keyword">add</span><span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$
  <span class="token keyword">return</span> <span class="token number">a</span> <span class="token operator">+</span> <span class="token number">b</span><span class="token punctuation">;</span>
$$ language plv8 immutable strict<span class="token punctuation">;</span>

<span class="token comment">-- Here’s a better example from the plv8 repo…</span>
<span class="token keyword">create</span> <span class="token keyword">function</span> plv8_test<span class="token punctuation">(</span><span class="token keyword">keys</span> <span class="token keyword">text</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vals <span class="token keyword">text</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">text</span> <span class="token keyword">as</span> $$
  var object <span class="token operator">=</span> {}
  <span class="token keyword">for</span> <span class="token punctuation">(</span>var i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">keys</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> {
    object<span class="token punctuation">[</span><span class="token keyword">keys</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> vals<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  }
  <span class="token keyword">return</span> JSON<span class="token punctuation">.</span>stringify<span class="token punctuation">(</span>object<span class="token punctuation">)</span>
$$ language plv8 immutable strict<span class="token punctuation">;</span>
</code></pre>
      </div>
<h2 id="named-arguments"><a href="#named-arguments" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Named Arguments</h2>
<p>PostgreSQL allows you to mix named and positional (unnamed) arguments for your procedures. However, GraphQL will <em>only</em> allow named arguments. So if you don’t name an argument, PostGraphile will give it a name like <code>arg1</code>, <code>arg2</code>, <code>arg3</code>, and so on. An example of a function with unnamed arguments is as follows:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> <span class="token keyword">add</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$
  <span class="token keyword">select</span> $<span class="token number">1</span> <span class="token operator">+</span> $<span class="token number">2</span><span class="token punctuation">;</span>
$$ <span class="token keyword">language sql</span> immutable strict<span class="token punctuation">;</span>
</code></pre>
      </div>
<p>Whereas named arguments look like:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> <span class="token keyword">add</span><span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$
  <span class="token keyword">select</span> <span class="token number">a</span> <span class="token operator">+</span> <span class="token number">b</span><span class="token punctuation">;</span>
$$ <span class="token keyword">language sql</span> immutable strict<span class="token punctuation">;</span>
</code></pre>
      </div>
<h2 id="mutation-procedures"><a href="#mutation-procedures" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mutation Procedures</h2>
<p>By default, a procedure is “volatile” and PostGraphile will treat it as a mutation. So for example, a procedure defined as:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> my_function<span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$ … $$ <span class="token keyword">language sql</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>Is equivalent to a procedure defined as:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> my_function<span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$ … $$ <span class="token keyword">language sql</span> volatile<span class="token punctuation">;</span>
</code></pre>
      </div>
<p>From the PostgreSQL docs:</p>
<blockquote>
<p><code>VOLATILE</code> indicates that the function value can change even within a single table scan, so no optimizations can be made…But note that any function that has side-effects must be classified volatile, even if its result is quite predictable, to prevent calls from being optimized away; an example is <code>setval()</code>.</p>
</blockquote>
<p>In simpler terms <code>VOLATILE</code> basically means you are changing your data.</p>
<p>Anyone familiar with HTTP could compare a <code>VOLATILE</code> procedure to “unsafe” HTTP methods like <code>POST</code>, <code>PUT</code>, and <code>DELETE</code>.</p>
<p>All mutative procedures will be represented in the GraphQL type system by PostGraphile in a way that is Relay compatible with a single input object. You would execute a procedure similar to this one like so:</p>
<div class="gatsby-highlight">
      <pre class="language-graphql"><code><span class="token keyword">mutation</span> <span class="token punctuation">{</span>
  myFunction<span class="token punctuation">(</span><span class="token attr-name">input</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">a</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">b</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    output
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Always look at the documentation in GraphiQL to find all the parameters you may use!</p>
<h2 id="query-procedures"><a href="#query-procedures" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query Procedures</h2>
<p>Similar to how you use <code>VOLATILE</code> to specify a mutative procedure, a query procedure can be specified using <code>IMMUTABLE</code> or <code>STABLE</code> identifiers. For example:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> my_function<span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$ … $$ <span class="token keyword">language sql</span> stable<span class="token punctuation">;</span>

<span class="token comment">-- or…</span>

<span class="token keyword">create</span> <span class="token keyword">function</span> my_function<span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">int</span> <span class="token keyword">as</span> $$ … $$ <span class="token keyword">language sql</span> immutable<span class="token punctuation">;</span>

<span class="token comment">-- or if you wanted to return a row from a table…</span>

<span class="token keyword">create</span> <span class="token keyword">function</span> my_function<span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> my_table <span class="token keyword">as</span> $$ … $$ <span class="token keyword">language sql</span> stable<span class="token punctuation">;</span>
</code></pre>
      </div>
<p>From the PostgreSQL docs:</p>
<blockquote>
<p><code>IMMUTABLE</code> indicates that the function cannot modify the database and always returns the same result when given the same argument values; that is, it does not do database lookups or otherwise use information not directly present in its argument list. If this option is given, any call of the function with all-constant arguments can be immediately replaced with the function value.</p>
</blockquote>
<p>and…</p>
<blockquote>
<p><code>STABLE</code> indicates that the function cannot modify the database, and that within a single table scan it will consistently return the same result for the same argument values, but that its result could change across SQL statements. This is the appropriate selection for functions whose results depend on database lookups, parameter variables (such as the current time zone), etc. (It is inappropriate for AFTER triggers that wish to query rows modified by the current command).</p>
</blockquote>
<p>To use the HTTP analogy again, <code>IMMUTABLE</code> and <code>STABLE</code> are comparable to “safe” HTTP methods like <code>GET</code> and <code>HEAD</code>.</p>
<p>To query such a procedure in PostGraphile you would do the following:</p>
<div class="gatsby-highlight">
      <pre class="language-graphql"><code><span class="token punctuation">{</span>
  <span class="token comment"># For a procedure without arguments</span>
  myFunction

  <span class="token comment"># For a procedure with arguments</span>
  myFunction<span class="token punctuation">(</span><span class="token attr-name">a</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">b</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>

  <span class="token comment"># For a procedure that returns a row</span>
  myFunction<span class="token punctuation">(</span><span class="token attr-name">a</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">b</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<h2 id="connection-procedures"><a href="#connection-procedures" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connection Procedures</h2>
<p>A connection query can be made from any function that returns a <code>setof</code> with a table type. This feature is also significant in that it gives you the ability to create complex queries over a set of data. Queries that connections (like <code>personNodes</code>) in PostGraphile do not support.</p>
<p>To create a function that returns a connection, use the following SQL:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token comment">-- Assuming we already have a table named `person`…</span>

<span class="token keyword">create</span> <span class="token keyword">function</span> my_function<span class="token punctuation">(</span><span class="token number">a</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">b</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> setof person <span class="token keyword">as</span> $$ … $$ <span class="token keyword">language sql</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>To query a set in PostGraphile, you would use all of the connection arguments you are familiar with in addition to the arguments to your procedure. For example:</p>
<div class="gatsby-highlight">
      <pre class="language-graphql"><code><span class="token punctuation">{</span>
  myFunction<span class="token punctuation">(</span><span class="token attr-name">a</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">b</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pageInfo <span class="token punctuation">{</span>
      hasNextPage
      hasPrevPage
    <span class="token punctuation">}</span>
    edges <span class="token punctuation">{</span>
      cursor
      node <span class="token punctuation">{</span>
        id
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>For more information on constructing advanced queries, read <a href="https://github.com/graphile/postgraphile/blob/master/docs/advanced-queries.md">this article</a>.</p>
<h2 id="computed-columns"><a href="#computed-columns" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Computed Columns</h2>
<p>PostGraphile also provides support for computed columns. In order to define a computed column, just write a function that is <code>STABLE</code> or <code>IMMUTABLE</code>, has a table in your schema as its first argument, and the name starts with the table’s name. For example:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> person_full_name<span class="token punctuation">(</span>person person<span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">text</span> <span class="token keyword">as</span> $$
  <span class="token keyword">select</span> person<span class="token punctuation">.</span>given_name <span class="token operator">||</span> <span class="token string">' '</span> <span class="token operator">||</span> person<span class="token punctuation">.</span>family_name
$$ <span class="token keyword">language sql</span> stable<span class="token punctuation">;</span>
</code></pre>
      </div>
<p>Will create a computed column for your table named <code>person</code>.</p>
<p>To query these in the PostGraphile schema, its pretty intuitive:</p>
<div class="gatsby-highlight">
      <pre class="language-graphql"><code><span class="token punctuation">{</span>
  person<span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> …<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    givenName
    familyName
    fullName <span class="token comment"># A computed column, but the client doesn’t even know!</span>
    myFunction<span class="token punctuation">(</span><span class="token attr-name">a</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token attr-name">b</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># A computed column with arguments.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<hr>
<p>For ideas on how to use procedures in PostGraphile, remember to check out the <a href="https://github.com/graphile/postgraphile/blob/master/examples/forum/schema.sql">forum example SQL schema</a>!</p>
<p><em>This example was originally written by <a href="https://twitter.com/calebmer">Caleb Meredith</a>.</em></p></div><br data-reactid="125"/><br data-reactid="126"/><div class="col-xs-12 mt3 mb5" data-reactid="127"><div class="row between-xs" data-reactid="128"><div class="col-xs-6" data-reactid="129"><a class="" href="/postgraphile/default-role/" data-reactid="130"><span class="fa fa-fw fa-long-arrow-left" data-reactid="131"></span><!-- react-text: 132 --> <!-- /react-text --><!-- react-text: 133 -->The Default Role<!-- /react-text --></a></div><div class="col-xs-6 tr" data-reactid="134"><a class="" href="/postgraphile/postgresql-schema-design/" data-reactid="135"><!-- react-text: 136 -->PostgreSQL Schema Design<!-- /react-text --><!-- react-text: 137 --> <!-- /react-text --><span class="fa fa-fw fa-long-arrow-right" data-reactid="138"></span></a></div></div></div></div></div></div></div></section></div><footer class="bg-white pv5 bt b--black f6 lh-copy" data-reactid="139"><div class="container" data-reactid="140"><div class="row" data-reactid="141"><div class="col-xs-12 col-md-2 nested-list-reset " data-reactid="142"><h6 data-reactid="143">PostGraphile</h6><ul data-reactid="144"><li data-reactid="145"><a href="/postgraphile/introduction/" data-reactid="146">Introduction</a></li><li data-reactid="147"><a href="/postgraphile/security/" data-reactid="148">Security</a></li><li data-reactid="149"><a href="/postgraphile/extending/" data-reactid="150">Extending</a></li></ul></div><div class="col-xs-12 col-md-2 nested-list-reset " data-reactid="151"><h6 data-reactid="152">Graphile Build</h6><ul data-reactid="153"><li data-reactid="154"><a href="/graphile-build/" data-reactid="155">About</a></li><li data-reactid="156"><a href="/graphile-build/getting-started/" data-reactid="157">Getting Started</a></li><li data-reactid="158"><a href="/graphile-build/plugins/" data-reactid="159">Plugins</a></li></ul></div><div class="col-xs-12 col-md-4 nested-list-reset" data-reactid="160"><h6 data-reactid="161">Community</h6><ul data-reactid="162"><li data-reactid="163"><a href="https://github.com/graphile" data-reactid="164">GitHub</a></li><li data-reactid="165"><a href="https://gitter.im/graphile/postgraphile" data-reactid="166">Gitter chat</a></li><li data-reactid="167"><a href="https://twitter.com/benjie" data-reactid="168">Twitter</a></li></ul></div><div class="col-xs-12 col-md-4" data-reactid="169"><h6 data-reactid="170">About</h6><!-- react-text: 171 -->PostGraphile and Graphile Build are Open Source Software, maintained by <!-- /react-text --><a href="https://twitter.com/benjie" data-reactid="172">Benjie Gillam</a><!-- react-text: 173 -->.<!-- /react-text --><br data-reactid="174"/><!-- react-text: 175 -->PostGraphile was <!-- /react-text --><a href="/history/" data-reactid="176">originally authored</a><!-- react-text: 177 --> as PostGraphQL by<!-- /react-text --><!-- react-text: 178 --> <!-- /react-text --><a href="https://twitter.com/calebmer" data-reactid="179">Caleb Meredith</a><!-- react-text: 180 -->.<!-- /react-text --><br data-reactid="181"/><br data-reactid="182"/><!-- react-text: 183 -->This site is copyright © Benjie Gillam <!-- /react-text --><!-- react-text: 184 -->2018<!-- /react-text --><!-- react-text: 185 -->. Design and logo copyright © Jof Arnold <!-- /react-text --><!-- react-text: 186 -->2018<!-- /react-text --><!-- react-text: 187 -->.<!-- /react-text --></div></div></div></footer></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-7cfd545637f6cabb4980.js","96961042003272":"component---src-templates-page-js-77e225def5937e05c33b.js","59784799166159":"component---src-templates-marketing-js-23021a9ef9424090e518.js","60335399758886":"path----557518bd178906f8d58a.js","45788430371641":"path---history-b12147f415477dfc92df.js","141666846945901":"path---support-536ff0b3e08bd80f1310.js","142629428675168":"path---index-b469f47a2642e25d5657.js","192423053311925":"path---graphile-build-pg-security-1a292d5a393b29d75f8d.js","133858743292129":"path---postgraphile-settings-b5449ca5220a1b804efd.js","128602041518144":"path---graphile-build-all-hooks-8178df5c8c35f3312c57.js","64023390553510":"path---graphile-build-build-object-e7bf6cd69fbf5a9df2bb.js","69504633912515":"path---graphile-build-context-object-8718050897b85182c9f4.js","125892818282768":"path---graphile-build-default-plugins-c13690cae702ffb3cbd7.js","109947277077173":"path---graphile-build-getting-started-e6bbd70828d5f346be9e.js","16210746157911":"path---graphile-build-graphile-build-e74c42ce60e4f0040880.js","57552969484094":"path---graphile-build-hooks-3b3a5e02ac9626ebf992.js","109627700230002":"path---graphile-build-ee68eb725e099e39487c.js","76338124382236":"path---graphile-build-look-ahead-00f39dd79c48a4e2f1d3.js","36474596372704":"path---graphile-build-omitting-plugins-625d4c27c2b259b7c7c4.js","276285638780302":"path---graphile-build-plugin-options-7a6a9ef4a1392a0fb379.js","136546493962690":"path---graphile-build-plugins-7d25fde4da7a0f4276c1.js","277477532944301":"path---graphile-build-schema-builder-69a88d3c6165c36d1132.js","99411096849217":"path---postgraphile-computed-columns-cc66faef7045b03e81c1.js","245194823331250":"path---postgraphile-connections-ad3db4ea42948d7f4ec4.js","226259727392765":"path---postgraphile-crud-mutations-8dd3c4be50a421426f7f.js","209456356109321":"path---postgraphile-custom-mutations-79268418a488eb1a2784.js","262226386268176":"path---postgraphile-custom-queries-b7bebe738538aec2dbdb.js","183024611244872":"path---postgraphile-default-role-2a78d704830516ee6c61.js","1465359564156":"path---postgraphile-extending-8a267e911f1d6e77f9f9.js","46110498460401":"path---postgraphile-evaluating-c641f5b08bf36a02a539.js","29661158995595":"path---postgraphile-filtering-47357e1671a532c1eb08.js","48764759135427":"path---postgraphile-074c190f76fa919d3168.js","231292683096477":"path---postgraphile-introduction-249172f334faedcc670a.js","33982096820675":"path---postgraphile-introspection-dd9fc4a2d1bfd9306739.js","217512476184238":"path---postgraphile-jwt-guide-de7539f972c958169173.js","245838197689590":"path---postgraphile-performance-465b06a8eceb30eee33f.js","43306645800525":"path---postgraphile-postgresql-indexes-f8762eed5dbac7533d85.js","257659440118484":"path---postgraphile-procedures-e873f35d9e807a23067e.js","17839233601159":"path---postgraphile-postgresql-schema-design-8fe9371ce25201d42e23.js","20524195157075":"path---postgraphile-quick-start-guide-8842ba0a3cc0e1c3fe1f.js","136696082986067":"path---postgraphile-relations-a6906569a6c033b32b15.js","187294999324209":"path---postgraphile-requirements-1dbe71dce552a766596e.js","143935096069691":"path---postgraphile-security-3474388fb53625a8f9d4.js","27297302318019":"path---postgraphile-smart-comments-f7617ab86e36a03c5ba0.js","3265662318058":"path---postgraphile-usage-cli-ff7cef594c84faf3126c.js","148070795768796":"path---postgraphile-usage-library-a4ded70c01dffb70b400.js","272066437984048":"path---postgraphile-usage-schema-69b3ef6123ac487f24b4.js","247601703930759":"path---postgraphile-usage-3463f6c73efc8b44b15f.js","87638492893048":"path---postgraphile-v-3-migration-c199e49f18ab96d41062.js","57656932303775":"path---postgraphile-v-4-new-features-cf885dab5576d6c6ed35.js","114276838955818":"component---src-layouts-index-js-f7e5fddfeabb77ba9307.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-097a3c7bcbdcfe23a531.js","/app-7cfd545637f6cabb4980.js","/path---postgraphile-procedures-e873f35d9e807a23067e.js","/component---src-templates-page-js-77e225def5937e05c33b.js","/component---src-layouts-index-js-f7e5fddfeabb77ba9307.js"])/*]]>*/</script><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script></body></html>