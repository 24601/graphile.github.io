<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NNK4X8M');</script><script src="https://use.fontawesome.com/c72bfae6f9.js"></script><link rel="preload" href="/component---src-layouts-index-js-f7e5fddfeabb77ba9307.js" as="script"/><link rel="preload" href="/component---src-templates-page-js-34ee4f7487ddc103f0e6.js" as="script"/><link rel="preload" href="/path---postgraphile-v-4-new-features-2a5a6af52252080430a9.js" as="script"/><link rel="preload" href="/app-55eb181718409ece5249.js" as="script"/><link rel="preload" href="/commons-e7373fdcf65c14d9e2ef.js" as="script"/><title data-react-helmet="true">Graphile | v4 Feature Guide</title><meta data-react-helmet="true" name="description" content="Utilities to build powerful and performant GraphQL APIs"/><meta data-react-helmet="true" name="keywords" content="GraphQL, API, Graph, PostgreSQL, PostGraphile, PostGraphQL, Postgres-GraphQL, server, plugins, introspection, reflection"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=5.0"/><link rel="stylesheet" href="/styles.css?t=2018-05-14T17-54-19.961Z"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NNK4X8M" height="0" width="0" style="display:none;visibility:hidden;"></iframe></noscript><div id="___gatsby"><div tabindex="-1" data-reactroot="" data-reactid="1" data-react-checksum="1145740302"><div class="template-page" data-reactid="2"><!-- react-empty: 3 --><header class="header content absolute z-999 w-100" data-reactid="4"><nav class="navbar" data-reactid="5"><div class="container" data-reactid="6"><input type="checkbox" class="navbar-toggler input-reset" id="toggle" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" data-reactid="7"/><div class="nav-controls nested-list-reset " data-reactid="8"><div class="navbar-crosses" data-reactid="9"><span class="line line-1" data-reactid="10"> </span><span class="line line-2" data-reactid="11"> </span><span class="line line-3" data-reactid="12"> </span></div><ul class="navbar-nav flex w-100" data-reactid="13"><li class="navbar-item" data-reactid="14"><a class="nav-link " href="/" data-reactid="15"><span class="home-icon fa fa-home" data-reactid="16"></span><!-- react-text: 17 --> <!-- /react-text --><span class="home" data-reactid="18">Home</span></a></li><!-- react-empty: 19 --><!-- react-empty: 20 --><!-- react-empty: 21 --><li class="navbar-item" data-reactid="22"><a class="nav-link " href="/postgraphile/" data-reactid="23">Overview</a></li><li class="navbar-item" data-reactid="24"><a class="nav-link active" href="/postgraphile/introduction/" data-reactid="25">Documentation</a></li><li class="navbar-item" data-reactid="26"><a class="nav-link " href="/postgraphile/pricing/" data-reactid="27">Pricing</a></li><!-- react-empty: 28 --><!-- react-empty: 29 --><!-- react-empty: 30 --><li class="navbar-item ml-auto navbar-item-right" data-reactid="31"><span class="searchbox-container" data-reactid="32"><input id="search-box" placeholder="Search" data-reactid="33"/><span class="fa fa-search searchbox-search" data-reactid="34"></span></span></li><li class="navbar-item navbar-item-right" data-reactid="35"><a class="nav-link " href="/support/" data-reactid="36">Services</a></li><li class="navbar-item navbar-item-right" data-reactid="37"><a class="nav-link" href="https://graphql-training.com" title="GraphQL Training in London, Europe and Remote" data-reactid="38"><!-- react-text: 39 -->GraphQL Training<!-- /react-text --><!-- react-text: 40 --> <!-- /react-text --><span class="fa fa-external-link-square" data-reactid="41"></span></a></li><li class="navbar-item navbar-item-right" data-reactid="42"><a class="nav-link nav-github-link flex items-center" href="https://github.com/graphile" data-reactid="43"><span class="f3 fa fa-github" data-reactid="44"></span><!-- react-text: 45 --> <!-- /react-text --><span class="github" data-reactid="46"><!-- react-text: 47 -->Github <!-- /react-text --><span class="fa fa-external-link-square" data-reactid="48"></span></span></a></li></ul></div></div></nav></header><div class="page-content" data-reactid="49"><section data-reactid="50"><div class="container" data-reactid="51"><div class="row between-xs" data-reactid="52"><aside class="sidebar col-xs-12 col-md-3 last-xs mt3" data-reactid="53"><section data-reactid="54"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="55"><span data-reactid="56">Overview</span></h4><div class="nested-list-reset" data-reactid="57"><ul class="page-list nav flex-column mb5" data-reactid="58"><li class="f6 lh-copy pv1" data-reactid="59"><a class="nav-link " href="/postgraphile/introduction/" data-reactid="60"><span data-reactid="61">Introduction</span></a></li><li class="f6 lh-copy pv1" data-reactid="62"><a class="nav-link " href="/postgraphile/quick-start-guide/" data-reactid="63"><span data-reactid="64">Quick Start Guide</span></a></li><li class="f6 lh-copy pv1" data-reactid="65"><a class="nav-link " href="/postgraphile/requirements/" data-reactid="66"><span data-reactid="67">Requirements</span></a></li><li class="f6 lh-copy pv1" data-reactid="68"><a class="nav-link " href="/postgraphile/performance/" data-reactid="69"><span data-reactid="70">Performance</span></a></li><li class="f6 lh-copy pv1" data-reactid="71"><a class="nav-link " href="/postgraphile/connections/" data-reactid="72"><span data-reactid="73">Connections</span></a></li><li class="f6 lh-copy pv1" data-reactid="74"><a class="nav-link " href="/postgraphile/filtering/" data-reactid="75"><span data-reactid="76">Filtering</span></a></li><li class="f6 lh-copy pv1" data-reactid="77"><a class="nav-link " href="/postgraphile/relations/" data-reactid="78"><span data-reactid="79">Relations</span></a></li><li class="f6 lh-copy pv1" data-reactid="80"><a class="nav-link " href="/postgraphile/crud-mutations/" data-reactid="81"><span data-reactid="82">CRUD Mutations</span></a></li><li class="f6 lh-copy pv1" data-reactid="83"><a class="nav-link " href="/postgraphile/computed-columns/" data-reactid="84"><span data-reactid="85">Computed Columns</span></a></li><li class="f6 lh-copy pv1" data-reactid="86"><a class="nav-link " href="/postgraphile/custom-queries/" data-reactid="87"><span data-reactid="88">Custom Queries</span></a></li><li class="f6 lh-copy pv1" data-reactid="89"><a class="nav-link " href="/postgraphile/custom-mutations/" data-reactid="90"><span data-reactid="91">Custom Mutations</span></a></li><li class="f6 lh-copy pv1" data-reactid="92"><a class="nav-link " href="/postgraphile/smart-comments/" data-reactid="93"><span data-reactid="94">Smart Comments</span></a></li><li class="f6 lh-copy pv1" data-reactid="95"><a class="nav-link " href="/postgraphile/security/" data-reactid="96"><span data-reactid="97">Security</span></a></li><li class="f6 lh-copy pv1" data-reactid="98"><a class="nav-link " href="/postgraphile/introspection/" data-reactid="99"><span data-reactid="100">Introspection</span></a></li><li class="f6 lh-copy pv1" data-reactid="101"><a class="nav-link " href="/postgraphile/extending/" data-reactid="102"><span data-reactid="103">Extending PostGraphile</span></a></li><li class="f6 lh-copy pv1" data-reactid="104"><a class="nav-link " href="/postgraphile/plugins/" data-reactid="105"><span data-reactid="106">Plugins <a href='/postgraphile/pricing/' class="plan-supporter"><span class='first-letter'>s</span><span class='rest'>upporter</span></a> <a href='/postgraphile/pricing/' class="plan-pro"><span class='first-letter'>p</span><span class='rest'>ro</span></a></span></a></li><li class="f6 lh-copy pv1" data-reactid="107"><a class="nav-link " href="/postgraphile/subscriptions/" data-reactid="108"><span data-reactid="109">Subscriptions <a href='/postgraphile/pricing/' class="plan-supporter"><span class='first-letter'>s</span><span class='rest'>upporter</span></a></span></a></li><li class="f6 lh-copy pv1" data-reactid="110"><a class="nav-link " href="/postgraphile/production/" data-reactid="111"><span data-reactid="112">Running in Production <a href='/postgraphile/pricing/' class="plan-pro"><span class='first-letter'>p</span><span class='rest'>ro</span></a></span></a></li></ul></div></section><section data-reactid="113"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="114"><span data-reactid="115">Guides</span></h4><div class="nested-list-reset" data-reactid="116"><ul class="page-list nav flex-column mb5" data-reactid="117"><li class="f6 lh-copy pv1" data-reactid="118"><a class="nav-link " href="/postgraphile/evaluating/" data-reactid="119"><span data-reactid="120">Evaluating for your Project</span></a></li><li class="f6 lh-copy pv1" data-reactid="121"><a class="nav-link " href="/postgraphile/jwt-guide/" data-reactid="122"><span data-reactid="123">PostGraphile JWT Guide</span></a></li><li class="f6 lh-copy pv1" data-reactid="124"><a class="nav-link " href="/postgraphile/default-role/" data-reactid="125"><span data-reactid="126">The Default Role</span></a></li><li class="f6 lh-copy pv1" data-reactid="127"><a class="nav-link " href="/postgraphile/procedures/" data-reactid="128"><span data-reactid="129">PostgreSQL Procedures</span></a></li><li class="f6 lh-copy pv1" data-reactid="130"><a class="nav-link " href="/postgraphile/postgresql-schema-design/" data-reactid="131"><span data-reactid="132">PostgreSQL Schema Design</span></a></li><li class="f6 lh-copy pv1" data-reactid="133"><a class="nav-link " href="/postgraphile/postgresql-indexes/" data-reactid="134"><span data-reactid="135">PostgreSQL Indexes</span></a></li><li class="f6 lh-copy pv1" data-reactid="136"><a class="nav-link active" href="/postgraphile/v4-new-features/" data-reactid="137"><span data-reactid="138">v4 Feature Guide</span></a></li><li class="f6 lh-copy pv1" data-reactid="139"><a class="nav-link " href="/postgraphile/v3-migration/" data-reactid="140"><span data-reactid="141">v3 → v4 Migration Guide</span></a></li></ul></div></section><section data-reactid="142"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="143"><span data-reactid="144">Usage</span></h4><div class="nested-list-reset" data-reactid="145"><ul class="page-list nav flex-column mb5" data-reactid="146"><li class="f6 lh-copy pv1" data-reactid="147"><a class="nav-link " href="/postgraphile/usage-cli/" data-reactid="148"><span data-reactid="149">CLI Usage</span></a></li><li class="f6 lh-copy pv1" data-reactid="150"><a class="nav-link " href="/postgraphile/usage-library/" data-reactid="151"><span data-reactid="152">Library Usage</span></a></li><li class="f6 lh-copy pv1" data-reactid="153"><a class="nav-link " href="/postgraphile/usage-schema/" data-reactid="154"><span data-reactid="155">Schema-only Usage</span></a></li></ul></div></section></aside><div class="col-xs-12 col-md-7 col-md-offset-1 first-xs main-content" data-reactid="156"><div class="row" data-reactid="157"><div class="col-xs-12" style="width:100%;" data-reactid="158"><h2 id="v4-feature-guide"><a href="#v4-feature-guide" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>v4 Feature Guide</h2>
<p>Though the entry point to v4 is almost identical to v3 (with a few additional
options!), the guts of PostGraphile have been re-written from the ground up -
about 80% of the codebase has been replaced with smaller dependencies in the
form of our new plugin-base schema generator.</p>
<p>You can read more about migrating from v3 to v4 in our migration guide (link at
bottom).</p>
<h4 id="performance-goodbye-n1-queries"><a href="#performance-goodbye-n1-queries" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Performance: goodbye N+1 queries!</h4>
<p>The performance of PostGraphile has massively increased over PostGraphQL v3;
and the memory usage has decreased too! If you run your database and
PostGraphile on different servers then you should find query times are improved
even further by the (significant!) reduction in the number of SQL queries that
we generate.</p>
<p>I created an <a href="https://github.com/graphile/postgraphile_changes/blob/master/db/reset.sh">example database
schema</a>
based on the forum example (but with some bells and whistles), filled it with
some data, and then benchmarked a <a href="https://github.com/graphile/postgraphile_changes/tree/master/graphql">number of queries</a>
against it (running everything locally on my machine (a 2011 iMac), using the
latest LTS release of Node.js for both v3 and v4).</p>
<p>The most extreme improvements came in the form of
<a href="https://github.com/graphile/postgraphile_changes/blob/master/graphql/ThreadViewWithEmoji.graphql">ThreadViewWithEmoji.graphql</a>.
This is a query that emulates loading the data to show a single thread page
within a complex forum - the thread itself (and its author), plus the first 20
posts within that thread, their authors, and the first 100 emoji responses that
each of the posts have received. It uses a computed column for the user
<code class="language-text">fullName</code>s, but other than that it's just regular relations.</p>
<ul>
<li>
<p>concurrency: 1</p>
<ul>
<li>v3: 644ms average latency, 1.51 req/s (peaking at 416MB RAM)</li>
<li>v4: 58ms average latency, 17.0 req/s (peaking at 98MB RAM)</li>
<li>Summary: 1030% more requests/second, 76% reduction in RAM usage, and less than 1/10th the latency</li>
</ul>
</li>
<li>
<p>concurrency: 10</p>
<ul>
<li>v3: 5477ms average latency, 1.77 req/s (peaking at 694MB RAM)</li>
<li>v4: 341ms average latency, 29.55 req/s (peaking at 98MB RAM)</li>
<li>Summary: 1570% more requests/second, 85.9% reduction in RAM usage, and nearly 1/20th the latency</li>
</ul>
</li>
<li>
<p>concurrency: 100</p>
<ul>
<li>v3: 63999ms average latency, 1.56 req/s (peaking at 1.5GB RAM)</li>
<li>v4: 2805ms average latency, 35.2 req/s (peaking at 114MB RAM)</li>
<li>Summary: 2160% more requests/second, 92.5% reduction in RAM usage, and less than 1/20th the latency</li>
</ul>
</li>
</ul>
<p>Simpler queries still reveal good performance improvements. One such example is
<a href="https://github.com/graphile/postgraphile_changes/blob/master/graphql/ProfileView.graphql">ProfileView.graphql</a>
which emulates loading the data to show a single forum user's profile - their
personal details, the latest post they've written (and the thread it's in) and
a total count of all posts they've written. At a concurrency level of 1, v4
achieves 195 req/s vs v3's 118 req/s (both execute with sub-10ms latency). At
concurrency 100 v4 achieves a whopping 407 req/s with average latency sub-250ms
(v3 achieves a pretty good 232 req/s at ~430ms average latency).</p>
<p>I think this shows that PostGraphile v4 is capable of scaling better than v3
when queries are complex and that's without spending any time actually
optimising the generated SQL queries yet - I think we'll be able to improve
performance quite a bit further still.</p>
<h4 id="plugins-plugins-plugins"><a href="#plugins-plugins-plugins" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Plugins plugins plugins</h4>
<p>The GraphQL schema that PostGraphile generates (and even the introspection it
performs on the database!) is now constructed out of a number of
<code class="language-text">graphile-build</code> plugins. <code class="language-text">graphile-build</code> was invented for PostGraphile
(though it is also suitable for use in other GraphQL projects) to enable easy
extensibility of the core system. This means we can now have community led
experiments such as
<a href="https://github.com/mattbretl/postgraphile-plugin-connection-filter">postgraphile-plugin-connection-filter</a>
(which adds a much more powerful filter engine to PostGraphile that the built in
<code class="language-text">condition</code> argument) without having to fork core. These plugins can be
maintained separately, and might be merged into core at a later point.</p>
<p>It's also possible to turn off, or even replace, built in plugins - and of
course to add your own. So you can really customise PostGraphile now!</p>
<p>Be warned though, writing a plugin is a fair undertaking right now - it's going
to take a while for the right interfaces and helpers to appear, so right now
you're wrestling with the raw API which can be pretty gnarly!</p>
<h4 id="order-order"><a href="#order-order" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Order! Order!</h4>
<p>Connections now support ordering by an array of columns rather than just one -
a much requested feature!</p>
<h4 id="column-level-select-grants-may-now-work"><a href="#column-level-select-grants-may-now-work" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Column-level SELECT grants may now work</h4>
<p>As part of the performance work, we now select only the fields we need (and we also inline computed columns, in case you're interested!). As such, if you have column-level SELECT grants you may find that this works with PostGraphile now. Note, however, that I do not recommend using these - instead I recommend splitting your concerns into multiple tables and use the one-to-one relationship feature to link them.</p>
<h4 id="one-to-one-relationships"><a href="#one-to-one-relationships" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>One-to-one relationships</h4>
<p>If you have tables like this:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> foo <span class="token punctuation">(</span>
  id <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> bar <span class="token punctuation">(</span>
  foo_id <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">references</span> foo<span class="token punctuation">,</span>
  name <span class="token keyword">text</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>in V3 the one-to-one nature of the relationship was not accounted for, so you would have to query like:</p>
<div class="gatsby-highlight">
      <pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span>
  fooById<span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># Due to this being one-to-one, at most one row would ever be returned,</span>
    <span class="token comment"># however we didn't account for this and returned a connection anyway</span>
    barsByFooId <span class="token punctuation">{</span>
      edges <span class="token punctuation">{</span>
        node <span class="token punctuation">{</span>
          name
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>with v4's native support for these relations you can now use this much neater query:</p>
<div class="gatsby-highlight">
      <pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span>
  fooById<span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    barByFooId <span class="token punctuation">{</span>
      name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>No more unnecessary indirection!</p>
<p>Don't worry though, we still have the old relation too, we've just deprecated it.</p>
<h4 id="cache-invalidation-serverless"><a href="#cache-invalidation-serverless" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cache invalidation (Serverless)</h4>
<p>People have been running PostGraphile on AWS Lambda and similar environments, and one of the common issues that I hear is that boot up time is too slow. V4 addresses this in two ways:</p>
<ol>
<li>we offer the <code class="language-text">--read-cache</code> and <code class="language-text">--write-cache</code> options that allow plugins (including the introspection plugin!) to cache work that they do up front - note that we do <em>not</em> handle invalidating this cache, so that remains your responsibility.</li>
<li>by changing the minimum requirements of PostGraphile to Node.js 8.6 we can make use of native async/await support, resulting in much less code for Node to parse and execute.</li>
</ol>
<p>If you want to improve things even further, you should consider bundling your server dependencies into one JS file with something like <code class="language-text">webpack</code> so that Node spends less time looking at the filesystem!</p>
<h4 id="naming-things"><a href="#naming-things" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Naming things</h4>
<p>You no longer have to trust us to come up with the best names for your fields. You can override all the names by supplying your own inflector. The interface around this is still coming to fruition, but the functionality is there!</p>
<p><a href="https://github.com/graphile/graphile-build/blob/master/packages/graphile-build-pg/src/inflections.js">https://github.com/graphile/graphile-build/blob/master/packages/graphile-build-pg/src/inflections.js</a></p>
<h4 id="better-support-better-errors"><a href="#better-support-better-errors" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Better support, better errors</h4>
<ul>
<li>Many previously invalid enums are now made valid</li>
<li>When the introspection results in an empty name, an error is thrown explaining why</li>
<li>Support <code class="language-text">point</code> type</li>
<li>When a name clashes for some reason, an error is thrown detailing what the field was, and on what type it is.</li>
<li>When you specify <code class="language-text">--schema</code> and that schema doesn't exist, you will be warned</li>
<li>Tables that end in <code class="language-text">_input</code> or <code class="language-text">_patch</code> are renamed to FooInputRecord or similar to avoid clashes with mutation types on other tables</li>
</ul>
<h4 id="deprecation--smart-comments"><a href="#deprecation--smart-comments" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deprecation / smart comments</h4>
<p>It's now possible to deprecate fields, tables, functions, etc by adding a "smart comment"; e.g.</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code class="language-sql"><span class="token keyword">comment</span> <span class="token keyword">on</span> <span class="token keyword">column</span> c<span class="token punctuation">.</span>person<span class="token punctuation">.</span>site <span class="token operator">is</span> <span class="token string">'@deprecated Use `website` instead\nThe user'</span><span class="token string">'s homepage'</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Smart comments (known internally as <code class="language-text">tags</code>) are not well documented yet, and
they currently only support the <code class="language-text">deprecated</code> feature; however we will be adding
more and more smart comments as time passes, they might be used to do things
such as hiding columns from GraphQL, overriding the names of things in GraphQL,
and much more. If you're interested in helping out here (or just making
suggestion!) please <a href="https://github.com/graphile/graphile-build/blob/master/packages/graphile-build-pg/__tests__/tags.test.js">check out the
tests</a>.</p>
<p>And file an issue!</p>
<h4 id="pg7x-and-duck-typed-pg"><a href="#pg7x-and-duck-typed-pg" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pg@7.x and duck-typed pg</h4>
<p>In v3 it was quite common to have conflicts with <code class="language-text">pg</code> - where you had your own
version installed, and PostGraphile installed it's own version, and when you
passed a pgPool over to PostGraphile it would throw an error. Well no more! We
now look at the pgPool you've handed us and if it quacks like <del>a duck</del>
<code class="language-text">pg.Pool</code> then we'll trust you and treat it as a pg.Pool.</p>
<h4 id="lots-of-hidden-features"><a href="#lots-of-hidden-features" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lots of hidden features</h4>
<p>There's absolutely loads of things going on under the hood that we've not
officially exposed yet. You can use some of this goodness (e.g.
<code class="language-text">pgColumnFilter</code>) by tapping into the <code class="language-text">graphileBuildOptions</code> setting, but
you'll currently have to go digging to see what they are and how they work; and
until they're documented they're seen as experimental so there's no guarantees
that they won't be removed or modified.</p></div><br data-reactid="159"/><br data-reactid="160"/><div class="col-xs-12 mt3 mb5" data-reactid="161"><div class="row between-xs" data-reactid="162"><div class="col-xs-6" data-reactid="163"><a class="" href="/postgraphile/postgresql-indexes/" data-reactid="164"><span class="fa fa-fw fa-long-arrow-left" data-reactid="165"></span><!-- react-text: 166 --> <!-- /react-text --><!-- react-text: 167 -->PostgreSQL Indexes<!-- /react-text --></a></div><div class="col-xs-6 tr" data-reactid="168"><a class="" href="/postgraphile/v3-migration/" data-reactid="169"><!-- react-text: 170 -->v3 → v4 Migration Guide<!-- /react-text --><!-- react-text: 171 --> <!-- /react-text --><span class="fa fa-fw fa-long-arrow-right" data-reactid="172"></span></a></div></div></div></div></div></div></div></section></div><footer class="bg-white pv5 bt b--black f6 lh-copy" data-reactid="173"><div class="container" data-reactid="174"><div class="row" data-reactid="175"><div class="col-xs-12 col-md-2 nested-list-reset " data-reactid="176"><h6 data-reactid="177">PostGraphile</h6><ul data-reactid="178"><li data-reactid="179"><a href="/postgraphile/introduction/" data-reactid="180">Introduction</a></li><li data-reactid="181"><a href="/postgraphile/security/" data-reactid="182">Security</a></li><li data-reactid="183"><a href="/postgraphile/extending/" data-reactid="184">Extending</a></li></ul></div><div class="col-xs-12 col-md-2 nested-list-reset " data-reactid="185"><h6 data-reactid="186">Graphile Build</h6><ul data-reactid="187"><li data-reactid="188"><a href="/graphile-build/" data-reactid="189">About</a></li><li data-reactid="190"><a href="/graphile-build/getting-started/" data-reactid="191">Getting Started</a></li><li data-reactid="192"><a href="/graphile-build/plugins/" data-reactid="193">Plugins</a></li></ul></div><div class="col-xs-12 col-md-4 nested-list-reset" data-reactid="194"><h6 data-reactid="195">Community</h6><ul data-reactid="196"><li data-reactid="197"><a href="https://github.com/graphile" data-reactid="198">GitHub</a></li><li data-reactid="199"><a href="https://gitter.im/graphile/postgraphile" data-reactid="200">Gitter chat</a></li><li data-reactid="201"><a href="https://twitter.com/benjie" data-reactid="202">Twitter</a></li></ul></div><div class="col-xs-12 col-md-4" data-reactid="203"><h6 data-reactid="204">About</h6><!-- react-text: 205 -->PostGraphile and Graphile Build are Open Source Software, maintained by <!-- /react-text --><a href="https://twitter.com/benjie" data-reactid="206">Benjie Gillam</a><!-- react-text: 207 -->.<!-- /react-text --><br data-reactid="208"/><!-- react-text: 209 -->PostGraphile was <!-- /react-text --><a href="/history/" data-reactid="210">originally authored</a><!-- react-text: 211 --> as PostGraphQL by<!-- /react-text --><!-- react-text: 212 --> <!-- /react-text --><a href="https://twitter.com/calebmer" data-reactid="213">Caleb Meredith</a><!-- react-text: 214 -->.<!-- /react-text --><br data-reactid="215"/><br data-reactid="216"/><!-- react-text: 217 -->This site is copyright © Benjie Gillam <!-- /react-text --><!-- react-text: 218 -->2018<!-- /react-text --><!-- react-text: 219 -->. Design and logo copyright © Jof Arnold <!-- /react-text --><!-- react-text: 220 -->2018<!-- /react-text --><!-- react-text: 221 -->.<!-- /react-text --></div></div></div></footer></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-55eb181718409ece5249.js","96961042003272":"component---src-templates-page-js-34ee4f7487ddc103f0e6.js","59784799166159":"component---src-templates-marketing-js-c30efd45f6e51f356dd9.js","60335399758886":"path----557518bd178906f8d58a.js","45788430371641":"path---history-bd4e57b32b6b676d40da.js","142629428675168":"path---index-ecdae46139eaa38b4395.js","192423053311925":"path---graphile-build-pg-security-530475ca102268c33040.js","133858743292129":"path---postgraphile-settings-bc610bf39fba71e9ac7b.js","141666846945901":"path---support-536ff0b3e08bd80f1310.js","128602041518144":"path---graphile-build-all-hooks-85418ce7fa9feb3b0aaa.js","64023390553510":"path---graphile-build-build-object-09378b9ae97eead70972.js","69504633912515":"path---graphile-build-context-object-5548b2d2ba161e9c611e.js","125892818282768":"path---graphile-build-default-plugins-d68ee86dbbc1f9fe914b.js","109947277077173":"path---graphile-build-getting-started-a25cd37361ad4505ad8b.js","16210746157911":"path---graphile-build-graphile-build-11708e8147728a8a380f.js","57552969484094":"path---graphile-build-hooks-992da7d0df272f938b2d.js","109627700230002":"path---graphile-build-2db41d1ba8e5671d3014.js","36474596372704":"path---graphile-build-omitting-plugins-6d70b9f632fefc0c9835.js","76338124382236":"path---graphile-build-look-ahead-07fa8c5c6e8b2323a690.js","276285638780302":"path---graphile-build-plugin-options-e57410d4dc258343788c.js","136546493962690":"path---graphile-build-plugins-d833ef3f1da8a17950da.js","277477532944301":"path---graphile-build-schema-builder-6525248f9aa7979e62a7.js","99411096849217":"path---postgraphile-computed-columns-ae5cf4bded553608c570.js","245194823331250":"path---postgraphile-connections-97a91fc1bd54a4ee5846.js","226259727392765":"path---postgraphile-crud-mutations-5969e50c7b2709f868f6.js","209456356109321":"path---postgraphile-custom-mutations-572764af013a27ccb660.js","262226386268176":"path---postgraphile-custom-queries-d05e2f6e8f889147ded8.js","183024611244872":"path---postgraphile-default-role-63c603c3995be8ebb9f0.js","46110498460401":"path---postgraphile-evaluating-24a27ee7e2e8e07806a6.js","1465359564156":"path---postgraphile-extending-cf26ccc8aa3d26967eb9.js","29661158995595":"path---postgraphile-filtering-5984105dceba91bbfef5.js","231292683096477":"path---postgraphile-introduction-7213823e8829c0e91af2.js","48764759135427":"path---postgraphile-013e4606f37e9b5b1886.js","33982096820675":"path---postgraphile-introspection-9381e1fc6867f345647c.js","217512476184238":"path---postgraphile-jwt-guide-bb787c7fe6987c9ddbf5.js","245838197689590":"path---postgraphile-performance-cb3efc5c9bd3cdfdc50d.js","34112019379484":"path---postgraphile-plugins-78b1a8caa12367bc5987.js","43306645800525":"path---postgraphile-postgresql-indexes-a0b9f13e0dcaad7cef6a.js","85182451526728":"path---postgraphile-pricing-9a42bfaded3d293f4abc.js","17839233601159":"path---postgraphile-postgresql-schema-design-d9d85087de8bc20672ad.js","257659440118484":"path---postgraphile-procedures-d1bc74bec1ad643073a6.js","163587040327238":"path---postgraphile-production-2b51a3a69cc4dc141fc1.js","20524195157075":"path---postgraphile-quick-start-guide-bd43487405fdcf7eaa03.js","136696082986067":"path---postgraphile-relations-c737b6a0a5ad89628c21.js","187294999324209":"path---postgraphile-requirements-f1981ef73edf3a258347.js","143935096069691":"path---postgraphile-security-320a005f8f25e76b9e47.js","27297302318019":"path---postgraphile-smart-comments-03a6d6b18f5055c3f229.js","112985368742066":"path---postgraphile-subscriptions-57298d14ada161300b12.js","3265662318058":"path---postgraphile-usage-cli-a0bec687ca9534f3ab27.js","148070795768796":"path---postgraphile-usage-library-52dba4cff0a377b87d16.js","272066437984048":"path---postgraphile-usage-schema-7c9edf27149f940878c1.js","247601703930759":"path---postgraphile-usage-7334fea10573a9129e1e.js","87638492893048":"path---postgraphile-v-3-migration-8d7b3926c579c10b94fa.js","57656932303775":"path---postgraphile-v-4-new-features-2a5a6af52252080430a9.js","114276838955818":"component---src-layouts-index-js-f7e5fddfeabb77ba9307.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-e7373fdcf65c14d9e2ef.js","/app-55eb181718409ece5249.js","/path---postgraphile-v-4-new-features-2a5a6af52252080430a9.js","/component---src-templates-page-js-34ee4f7487ddc103f0e6.js","/component---src-layouts-index-js-f7e5fddfeabb77ba9307.js"])/*]]>*/</script><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script></body></html>