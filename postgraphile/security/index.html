<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NNK4X8M');</script><script src="https://use.fontawesome.com/c72bfae6f9.js"></script><link rel="preload" href="/component---src-layouts-index-js-d940cd9599529ddd8baf.js" as="script"/><link rel="preload" href="/component---src-templates-page-js-aef27fe6fab65fb206bf.js" as="script"/><link rel="preload" href="/path---postgraphile-security-74fd8bf4df963dc78e91.js" as="script"/><link rel="preload" href="/app-344175527c81f535cce3.js" as="script"/><link rel="preload" href="/commons-af24df79ddc393e5cf48.js" as="script"/><script id="webpack-manifest">
            //<![CDATA[
            window.webpackManifest = {"15178676390636814000":"app-344175527c81f535cce3.js","3918056598153407000":"component---src-templates-marketing-js-b965387c11eeb57eec09.js","6354438848726490000":"component---src-templates-page-js-aef27fe6fab65fb206bf.js","3954140758598355500":"path----557518bd178906f8d58a.js","3000790572835897000":"path---history-a9de9ada75a9d2d5e212.js","9347362237655822000":"path---index-9fd1b417297ca7f44762.js","12610637221850356000":"path---graphile-build-pg-security-c8e3770fcfed343d054b.js","8428063392933112000":"path---graphile-build-all-hooks-222388e29011575f3af5.js","8772566600393005000":"path---postgraphile-settings-02451897c54a47444c14.js","4195836923314832400":"path---graphile-build-build-object-de42c5da4dbc03b3a5dd.js","4555055688090620000":"path---graphile-build-context-object-6c32267d5fc123d9ff0e.js","8250511738979511000":"path---graphile-build-default-plugins-224f3fdc0f7c2c7954f1.js","7184560962273474000":"path---graphile-build-32a58b408c083fbb9106.js","7205504750529626000":"path---graphile-build-getting-started-8e786cf478dd66e4afef.js","1062387460204904600":"path---graphile-build-graphile-build-02cb13f6b3e3fdad7949.js","3771791408109622300":"path---graphile-build-hooks-8ae0f537f10431448d49.js","5002895319514266000":"path---graphile-build-look-ahead-423b8154ad3181faaddd.js","2390399147881533400":"path---graphile-build-omitting-plugins-4b20734f4c605d687c00.js","18106655623105920000":"path---graphile-build-plugin-options-30e91f30ee8e3f18512f.js","8948711028338852000":"path---graphile-build-plugins-666b0e85f1e4c6143c57.js","6515005643110327000":"path---postgraphile-computed-columns-a4ecfbfc05d8c1eb1f99.js","18184767599037770000":"path---graphile-build-schema-builder-e9b92a54833d14fbac5b.js","16069087941836857000":"path---postgraphile-connections-68dbc25a6a94f6f11353.js","14828157494412298000":"path---postgraphile-crud-mutations-19de4755544d21f6d85e.js","13726931753980498000":"path---postgraphile-custom-mutations-20d0f5fd3a8aa001009f.js","3021897627100894700":"path---postgraphile-evaluating-9a71080ac9d2f673be19.js","11994700922543962000":"path---postgraphile-default-role-f4972862b080f5ea11a5.js","17185268450471195000":"path---postgraphile-custom-queries-55a420bbed49f8f91635.js","3195847254699379700":"path---postgraphile-e3fd986d70e9f7458ea4.js","1943873715935326000":"path---postgraphile-filtering-694c712750edc475a96a.js","2227050697239772200":"path---postgraphile-introspection-2a8e7b96e8e4b0c7a040.js","15157997279410745000":"path---postgraphile-introduction-6cae229332b23f911434.js","16111252123784985000":"path---postgraphile-performance-167db47eb126e8bdcdb6.js","14254897639210230000":"path---postgraphile-jwt-guide-3e2a644505fdf33feb07.js","2838144339183239000":"path---postgraphile-postgresql-indexes-95fdd10c62434f08d6a1.js","12274565075711388000":"path---postgraphile-requirements-67c32f7952c67b2910c6.js","8958514494574895000":"path---postgraphile-relations-b07899e17ab6517fe822.js","1169112013285621200":"path---postgraphile-postgresql-schema-design-f8ae3dee062f9da13235.js","16885969067605012000":"path---postgraphile-procedures-3f9b5557fe96db6ededb.js","9432930456023296000":"path---postgraphile-security-74fd8bf4df963dc78e91.js","214018445676298080":"path---postgraphile-usage-cli-f2796614e72bedc88e84.js","9703967671503860000":"path---postgraphile-usage-library-8860d76e8683fac8d0b4.js","17830146079722576000":"path---postgraphile-usage-schema-b074d3a307d6efe2d3c8.js","16226825268806257000":"path---postgraphile-usage-7fffbdc26ccaaee6c109.js","7489246917808536000":"component---src-layouts-index-js-d940cd9599529ddd8baf.js"}
            //]]>
            </script><title data-react-helmet="true">Graphile | Security</title><meta data-react-helmet="true" name="description" content="Utilities to build powerful and performant GraphQL APIs"/><meta data-react-helmet="true" name="keywords" content="GraphQL, API, Graph, PostgreSQL, PostGraphQL, server, plugins, introspection, reflection"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = location.hash.replace('#', '')
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><script>
  !function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",[
  "/commons-af24df79ddc393e5cf48.js","/app-344175527c81f535cce3.js","/path---postgraphile-security-74fd8bf4df963dc78e91.js","/component---src-templates-page-js-aef27fe6fab65fb206bf.js","/component---src-layouts-index-js-d940cd9599529ddd8baf.js"
])
  </script><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=5.0"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:125%/1.45em 'Quattrocento Sans','serif';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Quattrocento Sans','serif';font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:hsla(0,0%,0%,0.9);font-family:'Work Sans','sans-serif';font-weight:600;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:hsla(0,0%,0%,0.9);font-family:'Work Sans','sans-serif';font-weight:600;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:hsla(0,0%,0%,0.9);font-family:'Work Sans','sans-serif';font-weight:600;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:hsla(0,0%,0%,0.9);font-family:'Work Sans','sans-serif';font-weight:600;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:hsla(0,0%,0%,0.9);font-family:'Work Sans','sans-serif';font-weight:600;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:hsla(0,0%,0%,0.9);font-family:'Work Sans','sans-serif';font-weight:600;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}ul{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:0.85rem;line-height:1.45rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}blockquote{margin-left:1.45rem;margin-right:1.45rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.45rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.45rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li > ul{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.45rem / 2);}code{font-size:0.85rem;line-height:1.45rem;}kbd{font-size:0.85rem;line-height:1.45rem;}samp{font-size:0.85rem;line-height:1.45rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.96667rem;padding-right:0.96667rem;padding-top:0.725rem;padding-bottom:calc(0.725rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{text-shadow:initial;color:initial;background-color:initial;}</style><link href="//fonts.googleapis.com/css?family=Work+Sans:600|Quattrocento+Sans:400,400i,700" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="/styles.css?t=2017-08-17T08-36-11.541Z"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NNK4X8M" height="0" width="0" style="display:none;visibility:hidden;"></iframe></noscript><div id="___gatsby"><div tabindex="-1" data-reactroot="" data-reactid="1" data-react-checksum="-1694918731"><div class="template-page" data-reactid="2"><!-- react-empty: 3 --><header class="content" data-reactid="4"><nav class="navbar" data-reactid="5"><div class="container" data-reactid="6"><input type="checkbox" class="navbar-toggler" id="toggle" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" data-reactid="7"/><div class="nav-controls" data-reactid="8"><div class="navbar-crosses" data-reactid="9"><span class="line line-1" data-reactid="10"> </span><span class="line line-2" data-reactid="11"> </span><span class="line line-3" data-reactid="12"> </span></div><ul class="navbar-nav" data-reactid="13"><li class="navbar-item navbar-item--left" data-reactid="14"><a class="nav-link " href="/" data-reactid="15"><span class="fa fa-home" data-reactid="16"></span><!-- react-text: 17 --> <!-- /react-text --><span class="home" data-reactid="18">Home</span></a></li><li class="navbar-item navbar-item--left" data-reactid="19"><a class="nav-link active" href="/postgraphile/" data-reactid="20">PostGraphile</a></li><li class="navbar-item navbar-item--left" data-reactid="21"><a class="nav-link " href="/graphile-build/" data-reactid="22">Graphile Build</a></li><li class="navbar-item ml-auto navbar-item navbar-item--right" data-reactid="23"><span class="searchbox-container" data-reactid="24"><input id="search-box" placeholder="Search" data-reactid="25"/><span class="fa fa-search searchbox-search" data-reactid="26"></span></span></li><li class="navbar-item navbar-item--right" data-reactid="27"><a class="nav-github-link nav-link" href="https://github.com/graphile/graphile-build" data-reactid="28"><span class="fa fa-github" data-reactid="29"></span><!-- react-text: 30 --> <!-- /react-text --><span class="github" data-reactid="31">Github</span></a></li></ul></div></div></nav></header><div class="page-content" data-reactid="32"><section data-reactid="33"><div class="container" data-reactid="34"><div class="row between-xs" data-reactid="35"><aside class="sidebar col-xs-12 col-md-3 last-xs" data-reactid="36"><section data-reactid="37"><h4 class="sidebar-title" data-reactid="38">Overview</h4><ul class="page-list nav flex-column" data-reactid="39"><li class="nav-item" data-reactid="40"><a class="nav-link " href="/postgraphile/introduction/" data-reactid="41">Introduction</a></li><li class="nav-item" data-reactid="42"><a class="nav-link " href="/postgraphile/requirements/" data-reactid="43">Requirements</a></li><li class="nav-item" data-reactid="44"><a class="nav-link " href="/postgraphile/performance/" data-reactid="45">Performance</a></li><li class="nav-item" data-reactid="46"><a class="nav-link " href="/postgraphile/connections/" data-reactid="47">Connections</a></li><li class="nav-item" data-reactid="48"><a class="nav-link " href="/postgraphile/filtering/" data-reactid="49">Filtering</a></li><li class="nav-item" data-reactid="50"><a class="nav-link " href="/postgraphile/relations/" data-reactid="51">Relations</a></li><li class="nav-item" data-reactid="52"><a class="nav-link " href="/postgraphile/crud-mutations/" data-reactid="53">CRUD Mutations</a></li><li class="nav-item" data-reactid="54"><a class="nav-link " href="/postgraphile/computed-columns/" data-reactid="55">Computed Columns</a></li><li class="nav-item" data-reactid="56"><a class="nav-link " href="/postgraphile/custom-queries/" data-reactid="57">Custom Queries</a></li><li class="nav-item" data-reactid="58"><a class="nav-link " href="/postgraphile/custom-mutations/" data-reactid="59">Custom Mutations</a></li><li class="nav-item" data-reactid="60"><a class="nav-link active" href="/postgraphile/security/" data-reactid="61">Security</a></li><li class="nav-item" data-reactid="62"><a class="nav-link " href="/postgraphile/introspection/" data-reactid="63">Introspection</a></li></ul></section><section data-reactid="64"><h4 class="sidebar-title" data-reactid="65">Guides</h4><ul class="page-list nav flex-column" data-reactid="66"><li class="nav-item" data-reactid="67"><a class="nav-link " href="/postgraphile/evaluating/" data-reactid="68">Evaluating for your Project</a></li><li class="nav-item" data-reactid="69"><a class="nav-link " href="/postgraphile/jwt-guide/" data-reactid="70">PostGraphile JWT Guide</a></li><li class="nav-item" data-reactid="71"><a class="nav-link " href="/postgraphile/default-role/" data-reactid="72">The Default Role</a></li><li class="nav-item" data-reactid="73"><a class="nav-link " href="/postgraphile/procedures/" data-reactid="74">PostgreSQL Procedures</a></li><li class="nav-item" data-reactid="75"><a class="nav-link " href="/postgraphile/postgresql-schema-design/" data-reactid="76">PostgreSQL Schema Design</a></li><li class="nav-item" data-reactid="77"><a class="nav-link " href="/postgraphile/postgresql-indexes/" data-reactid="78">PostgreSQL Indexes</a></li></ul></section><section data-reactid="79"><h4 class="sidebar-title" data-reactid="80">Usage</h4><ul class="page-list nav flex-column" data-reactid="81"><li class="nav-item" data-reactid="82"><a class="nav-link " href="/postgraphile/usage-cli/" data-reactid="83">CLI Usage</a></li><li class="nav-item" data-reactid="84"><a class="nav-link " href="/postgraphile/usage-library/" data-reactid="85">Library Usage</a></li><li class="nav-item" data-reactid="86"><a class="nav-link " href="/postgraphile/usage-schema/" data-reactid="87">Schema-only Usage</a></li></ul></section></aside><div class="col-xs-12 col-md-9 first-xs main-content" data-reactid="88"><div class="row" data-reactid="89"><div class="col-xs-12" style="width:100%;" data-reactid="90"><h2 id="security"><a href="#security" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Security</h2>
<p>Traditionally in web application architectures the security is implemented in
the server layer and the database is treated as a simple store of data. Partly
this was due to necessity (the security policies offered by databases such as
PostgreSQL were simply not granular enough), and partly this was people
figuring it would reduce the workload on the database thus increases
scalability. However, as applications grow, they start needing more advanced
features or additional services to interact with the database.  There's a
couple options they have here: duplicate the authentication/authorization logic
in multiple places (which can lead to discrepancies and increases the surface
area for potential issues), or make sure everything goes through the original
application layer (which then becomes both the development and performance
bottleneck).</p>
<p>However, this is no longer necessary since PostgreSQL introduced much more
granular permissions in the form of <a href="https://www.postgresql.org/docs/9.6/static/ddl-rowsecurity.html">Row-Level Security (RLS)
policies</a> in
PostgreSQL 9.5 back at the beginning of 2016. Now you can combine this with
PostgreSQL established permissions system (based on roles) allowing your
application to be considerably more specific about permissions: adding
row-level permission constraints to the existing table- and column-based
permissions.</p>
<p>Now that this functionality is stable and proven, we advise that you protect
your lowest level - the data itself. By doing so you can be sure that no matter
how many services interact with your database they will all be protected by the
same underlying permissions logic, which you only need to maintain in one
place. You can add as many microservices as you like, and they can talk to the
database directly!</p>
<p>When enabled, all rows are by default not visible to any roles (except database
administration roles and the role who created the database/table); and
permission is selectively granted with the use of policies.</p>
<p>If you already have a secure database schema that implements these technologies
to protect your data at the lowest levels then you can leverage
<code>postgraphile</code> to generate a powerful, secure and fast API very rapidly. You
just need to generate JWT tokens for your users, and we even help you with
that!</p>
<h3 id="processing-jwts"><a href="#processing-jwts" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Processing JWTs</h3>
<p>To enable the JWT functionality you must provide a <code>--jwt-secret</code> on the CLI
(or <code>jwtSecret</code> to the library options). This will allow PostGraphile to
authenticate incoming JWTs and set the granted claims on the database
transaction.</p>
<p>You should also supply a <code>--default-role</code> which is used for requests that don't
specify a role.</p>
<h3 id="generating-jwts"><a href="#generating-jwts" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating JWTs</h3>
<p>PostGraphile also has support for generating JWTs easily from inside your
PostgreSQL schema. To do so you must name a composite type via
<code>--jwt-token-identifier</code>, this will then be combined with the secret from
<code>--jwt-secret</code> to generate a string JWT that the client can then consume.</p>
<h3 id="sending-jwts-to-the-server"><a href="#sending-jwts-to-the-server" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sending JWTs to the server</h3>
<p>JWTs are sent via the best practice <code>Authorization</code> header:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>Authorization: Bearer JWT_TOKEN_HERE</code></pre>
      </div>
<p>e.g. with Apollo:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code>networkInterface<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">getJWTFromSomewhere</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span>options<span class="token punctuation">.</span>headers <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>options<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        authorization<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>or with Relay:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code>Relay<span class="token punctuation">.</span><span class="token function">injectNetworkLayer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Relay<span class="token punctuation">.</span>DefaultNetworkLayer</span><span class="token punctuation">(</span><span class="token string">'/graphql'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      Authorization<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<h3 id="how-it-works"><a href="#how-it-works" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How it works</h3>
<p>Your JWT token will include a number of claims, something like:</p>
<div class="gatsby-highlight">
      <pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">"aud"</span><span class="token operator">:</span> <span class="token string">"postgraphql"</span><span class="token punctuation">,</span>
  <span class="token property">"role"</span><span class="token operator">:</span> <span class="token string">"app_user"</span><span class="token punctuation">,</span>
  <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token number">27</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>When we verify that the JWT token is for us (via <code>aud: "postgraphql"</code>) we can
authenticate the PostgreSQL client that is used to perform the GraphQL query.
We do this as follows:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">begin</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token keyword">local</span> role app_user<span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token keyword">local</span> jwt<span class="token punctuation">.</span>claims<span class="token punctuation">.</span>role <span class="token keyword">to</span> <span class="token string">'app_user'</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token keyword">local</span> jwt<span class="token punctuation">.</span>claims<span class="token punctuation">.</span>user_id <span class="token keyword">to</span> <span class="token string">'2'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">-- WE PERFORM GRAPHQL QUERIES HERE</span>

<span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p><em>* Actually to save roundtrips we perform just one query to set all configs
via `select set</em>config('role', 'app<em>user', true), set</em>config('user<em>id', '2',
true), ....<code>, but the</code>set local` is easier to understand)</em></p>
<p>You can then access this information via <code>current_setting</code> (the second argument
says it's okay for the property to be missing, but <strong>only works in PostgreSQL
9.6+</strong>, in previous versions you'll need to set the setting on the database to
the empty string); for example here's a helper function:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> current_user_id<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token keyword">integer</span> <span class="token keyword">as</span> $$
  <span class="token keyword">select</span> <span class="token keyword">nullif</span><span class="token punctuation">(</span>current_setting<span class="token punctuation">(</span><span class="token string">'jwt.claims.user_id'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>::<span class="token keyword">integer</span><span class="token punctuation">;</span>
$$ <span class="token keyword">language sql</span> stable security <span class="token keyword">definer</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>e.g. you might have a row level policy such as:</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code><span class="token keyword">create</span> policy update_if_author
  <span class="token keyword">on</span> comments
  <span class="token keyword">for</span> <span class="token keyword">update</span>
  <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token string">"userId"</span> <span class="token operator">=</span> current_user_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">with</span> <span class="token keyword">check</span> <span class="token punctuation">(</span><span class="token string">"userId"</span> <span class="token operator">=</span> current_user_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div></div><br data-reactid="91"/><br data-reactid="92"/><div class="col-xs-12" data-reactid="93"><div class="row between-xs" data-reactid="94"><div class="col-xs-6" data-reactid="95"><a class="btn btn-secondary btn-large" href="/postgraphile/custom-mutations/" data-reactid="96"><!-- react-text: 97 -->← <!-- /react-text --><!-- react-text: 98 -->Custom Mutations<!-- /react-text --></a></div><div class="col-xs-6 right" data-reactid="99"><a class="btn btn-primary btn-large" href="/postgraphile/introspection/" data-reactid="100"><!-- react-text: 101 -->Introspection<!-- /react-text --><!-- react-text: 102 --> →<!-- /react-text --></a></div></div></div></div></div></div></div></section></div><footer data-reactid="103"><div class="container" data-reactid="104"><div class="row justify-content-center" data-reactid="105"><div class="col-xs-12 col-md-1-5" data-reactid="106"></div><div class="col-xs-12 col-md-8" data-reactid="107"><div class="container" data-reactid="108"><div class="row" data-reactid="109"><div class="col-xs-12 col-md-4" data-reactid="110"><h6 data-reactid="111">PostGraphile</h6><ul data-reactid="112"><li data-reactid="113"><a href="/postgraphile/" data-reactid="114">About</a></li><li data-reactid="115"><a href="/postgraphile/introduction/" data-reactid="116">Introduction</a></li><li data-reactid="117"><a href="/postgraphile/security/" data-reactid="118">Security</a></li></ul></div><div class="col-xs-12 col-md-4" data-reactid="119"><h6 data-reactid="120">Graphile Build</h6><ul data-reactid="121"><li data-reactid="122"><a href="/graphile-build/" data-reactid="123">About</a></li><li data-reactid="124"><a href="/graphile-build/getting-started/" data-reactid="125">Getting Started</a></li><li data-reactid="126"><a href="/graphile-build/plugins/" data-reactid="127">Plugins</a></li></ul></div><div class="col-xs-12 col-md-4" data-reactid="128"><h6 data-reactid="129">Community</h6><ul data-reactid="130"><li data-reactid="131"><a href="https://github.com/graphile" data-reactid="132">GitHub</a></li><li data-reactid="133"><a href="https://gitter.im/postgraphql/postgraphql" data-reactid="134">Gitter chat</a></li><li data-reactid="135"><a href="https://twitter.com/benjie" data-reactid="136">Twitter</a></li></ul></div></div></div></div></div><div class="row copyright justify-content-center" data-reactid="137"><div class="col-xs-12 col-md-8 center italic" data-reactid="138"><!-- react-text: 139 -->PostGraphile and Graphile Build are Open Source Software, maintained by <!-- /react-text --><a href="https://twitter.com/benjie" data-reactid="140">Benjie Gillam</a><!-- react-text: 141 -->.<!-- /react-text --><br data-reactid="142"/><!-- react-text: 143 -->PostGraphile was <!-- /react-text --><a href="/history/" data-reactid="144">originally authored</a><!-- react-text: 145 --> as PostGraphQL by<!-- /react-text --><!-- react-text: 146 --> <!-- /react-text --><a href="https://twitter.com/calebmer" data-reactid="147">Caleb Meredith</a><!-- react-text: 148 -->.<!-- /react-text --><br data-reactid="149"/><br data-reactid="150"/><!-- react-text: 151 -->This site is copyright © Benjie Gillam 2017.<!-- /react-text --></div></div></div></footer></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script></body></html>